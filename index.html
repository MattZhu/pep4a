<!doctype html>
<html>
	<head>
	<style>
		.container {
			position:relative;
			width:100%;
				margin:0;

		}
		.active {
			border:thick solid #FF0000;
			border-radius: 1.2rem;
		}		
		@media (min-width: 800px){
			.content {
				width:80%;
				margin: auto;
			}
		    img {
				padding: 0;
				display: block;
				width:100%;
				max-width:100%;
				height: auto;
			}
			.container {
				width:80%;
				float:right;
			}
			html, body {
			   height: 100%;
			   margin: 5px;
			   padding: 0;
			}
			#menu{
			    text-align: center;
				float:left;
			}
			#menu > div {
				
			}
		}
		@media (max-width: 800px){
			.content {
				width:100%;
				margin: auto;
			}
		    img {
				padding: 0;
				display: block;
				max-width:100%;
				width:100%;
				height: auto;
			}
			#menu{
			    text-align: center;
				padding:.3rem;
			}
			#menu > div {
				display:inline-block;
				margin-left:.2rem;
				margin-right:.2rem;
			}
			html, body {
			   height: 100%;
			   margin: 1px;
			   padding: 0;
			}

		}
	</style>
	<title>PEP 4A </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	</head>
	<body>
		<div class="content">
			<div id="container" class="container"></div>
			<div id="menu">
				<div onclick="unit(1)">Unit 1</div>
				<div onclick="unit(2)">Unit 2</div>
				<div onclick="unit(3)">Unit 3</div>
				<div onclick="unit(4)">Unit 4</div>
				<div onclick="unit(5)">Unit 5</div>
				<div onclick="unit(6)">Unit 6</div>
			</div>
		</div>
		<script src="js/book.js"></script>
		<script>
		    var currentPage=0;
			
			var audios=[];
		    var lastActive;
			var container=document.getElementById("container");
			container.addEventListener("touchstart", touchstart);
			container.addEventListener("touchend", touchend);
			var startX,startY;
			function imgClick(e){
				if(e.offsetX>e.currentTarget.width-100){
					nextPage();
				}else if(e.offsetX<100){
					previousPage();
				}
			}
			function touchstart(e){
				startX=e.touches[0].pageX;
				startY=e.touches[0].pageY;
			}
			function touchend(e){
				var xMove=e.changedTouches[0].pageX-startX;
				var yMove=e.changedTouches[0].pageY-startY;
				if(xMove>20){
					previousPage();
					return;
				}
				if(xMove<-20){
					nextPage();
					return;
				}
			}
			function init(page){				
				container.innerHTML='';
				var img=document.createElement('img');
				
			    var unitHeader=document.getElementById("unit");
				if(page.unit!==undefined){
			        document.title='PEP 4A - '+units[page.unit].title;
				}else{
				    document.title='PEP 4A';
			   }
				img.src='picture/'+page.image;	
				img.addEventListener("click", imgClick);
				container.appendChild(img);
				img.onload=function(){
				    var scale=img.clientWidth/540;
					audios=[];
				    for(var i=0;i<page.audio.length;i++){
					    var audio=page.audio[i];
						var div=document.createElement('div');

						div.style.position='absolute';
						div.style.left=img.x-container.offsetLeft+audio.left*scale+'px';
						div.style.top=img.y-container.offsetTop+audio.top*scale+'px';
						div.style.height=audio.height*scale+'px';
						div.style.width=audio.width*scale+'px';
						container.appendChild(div);
						var audioEle=document.createElement('audio');
						audioEle.src='audio/'+audio.src;
						audios[i]=audioEle;
						div.setAttribute('idx',i);
						div.addEventListener("click", playAudio);
					}
				}
			}
		
			function playAudio(){
			    if(lastActive){
					lastActive.classList.remove('active');
				}
				lastActive=this;
				this.classList.add('active');
				audios[this.getAttribute('idx')].play();
			}
			function nextPage(){
				if(currentPage<pages.length-1){
					currentPage++;
					init(pages[currentPage]);
				}
			}
			function previousPage(){
			    if(currentPage>0){
					currentPage--;
					init(pages[currentPage]);
				}
			}
			function unit(idx){
				var u=units[idx-1];
				if(u){
					 init(pages[u.firstPage]);
				}
			}
			init(pages[currentPage]);
			
			
		</script>
	</body>
	
</html>